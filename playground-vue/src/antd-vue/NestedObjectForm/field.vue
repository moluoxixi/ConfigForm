<template>
  <div>
    <h2>åµŒå¥—å¯¹è±¡ï¼ˆField ç‰ˆï¼‰</h2>
    <p style="color: rgba(0,0,0,0.45); margin-bottom: 16px; font-size: 14px;">
      å¤šçº§åµŒå¥—ç»“æ„ / void Card åˆ†ç»„å¯è§†åŒ– / void ä¸å‚ä¸æ•°æ®è·¯å¾„ - FormField + fieldProps å®ç°
    </p>
    <StatusTabs ref="st" v-slot="{ showResult }">
      <FormProvider :form="form">
          <div style="border: 1px solid #d9d9d9; border-radius: 8px; padding: 16px; margin-bottom: 16px">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px">ğŸ‘¤ ä¸ªäººä¿¡æ¯</div>
            <FormField name="title" :field-props="{ label: 'æ ‡é¢˜', required: true, component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥æ ‡é¢˜' } }" />
            <FormField name="name" :field-props="{ label: 'å§“å', required: true, component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥å§“å' } }" />
            <FormField name="age" :field-props="{ label: 'å¹´é¾„', component: 'InputNumber', componentProps: { min: 0, max: 150, style: { width: '100%' } } }" />
            <FormField name="gender" :field-props="{ label: 'æ€§åˆ«', component: 'Select', dataSource: GENDER_OPTIONS, componentProps: { placeholder: 'è¯·é€‰æ‹©' } }" />
          </div>
          <div style="border: 1px solid #d9d9d9; border-radius: 8px; padding: 16px; margin-bottom: 16px">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px">ğŸ“ è”ç³»æ–¹å¼</div>
            <FormField name="phone" :field-props="{ label: 'æ‰‹æœºå·', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥æ‰‹æœºå·' }, rules: [{ format: 'phone', message: 'æ— æ•ˆæ‰‹æœºå·' }] }" />
            <FormField name="email" :field-props="{ label: 'é‚®ç®±', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥é‚®ç®±' }, rules: [{ format: 'email', message: 'æ— æ•ˆé‚®ç®±' }] }" />
            <FormField name="emergencyName" :field-props="{ label: 'ç´§æ€¥è”ç³»äºº', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
            <FormField name="emergencyRelation" :field-props="{ label: 'å…³ç³»', component: 'Select', dataSource: RELATION_OPTIONS, componentProps: { placeholder: 'è¯·é€‰æ‹©' } }" />
            <FormField name="emergencyPhone" :field-props="{ label: 'ç´§æ€¥è”ç³»ç”µè¯', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
          </div>
          <div style="border: 1px solid #d9d9d9; border-radius: 8px; padding: 16px; margin-bottom: 16px">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px">ğŸ“ åœ°å€</div>
            <FormField name="province" :field-props="{ label: 'çœä»½', component: 'Select', dataSource: PROVINCE_OPTIONS, componentProps: { placeholder: 'è¯·é€‰æ‹©' } }" />
            <FormField name="city" :field-props="{ label: 'åŸå¸‚', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥åŸå¸‚' } }" />
            <FormField name="zipCode" :field-props="{ label: 'é‚®ç¼–', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥é‚®ç¼–' } }" />
            <FormField name="addressDetail" :field-props="{ label: 'è¯¦ç»†åœ°å€', component: 'Textarea', componentProps: { placeholder: 'è¯·è¾“å…¥è¯¦ç»†åœ°å€' } }" />
          </div>
          <div style="border: 1px solid #d9d9d9; border-radius: 8px; padding: 16px; margin-bottom: 16px">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px">ğŸ¢ å…¬å¸ä¿¡æ¯</div>
            <FormField name="companyName" :field-props="{ label: 'å…¬å¸åç§°', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
            <FormField name="department" :field-props="{ label: 'éƒ¨é—¨', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
            <FormField name="position" :field-props="{ label: 'èŒä½', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
            <FormField name="building" :field-props="{ label: 'æ¥¼æ ‹', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
            <FormField name="floor" :field-props="{ label: 'æ¥¼å±‚', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
            <FormField name="seat" :field-props="{ label: 'å·¥ä½å·', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥' } }" />
          </div>
          <div style="border: 1px solid #d9d9d9; border-radius: 8px; padding: 16px; margin-bottom: 16px">
            <div style="font-weight: 600; margin-bottom: 12px; font-size: 14px">âš™ï¸ åå¥½è®¾ç½®</div>
            <FormField name="theme" :field-props="{ label: 'ä¸»é¢˜', component: 'RadioGroup', dataSource: THEME_OPTIONS }" />
            <FormField name="customColor" :field-props="{ label: 'è‡ªå®šä¹‰é¢œè‰²', component: 'Input', componentProps: { placeholder: 'è¯·è¾“å…¥é¢œè‰²å€¼' } }" />
            <FormField name="emailNotify" :field-props="{ label: 'é‚®ä»¶é€šçŸ¥', component: 'Switch' }" />
            <FormField name="smsNotify" :field-props="{ label: 'çŸ­ä¿¡é€šçŸ¥', component: 'Switch' }" />
            <FormField name="dnd" :field-props="{ label: 'å…æ‰“æ‰°', component: 'Switch' }" />
          </div>
          <LayoutFormActions @submit="showResult" @submit-failed="(e: any) => st?.showErrors(e)" />
      </FormProvider>
    </StatusTabs>
  </div>
</template>

<script setup lang="ts">
import type { FieldPattern } from '@moluoxixi/shared'
import { LayoutFormActions, setupAntdVue, StatusTabs } from '@moluoxixi/ui-antd-vue'
import { FormField, FormProvider, useCreateForm } from '@moluoxixi/vue'
import { ref, watch } from 'vue'

setupAntdVue()

// ========== æ•°æ® ==========

/** æ€§åˆ«é€‰é¡¹ */
const GENDER_OPTIONS = [{ label: 'ç”·', value: 'male' }, { label: 'å¥³', value: 'female' }]

/** ç´§æ€¥è”ç³»äººå…³ç³»é€‰é¡¹ */
const RELATION_OPTIONS = [{ label: 'é…å¶', value: 'spouse' }, { label: 'çˆ¶æ¯', value: 'parent' }, { label: 'æœ‹å‹', value: 'friend' }]

/** çœä»½é€‰é¡¹ */
const PROVINCE_OPTIONS = [{ label: 'åŒ—äº¬', value: 'beijing' }, { label: 'ä¸Šæµ·', value: 'shanghai' }, { label: 'å¹¿ä¸œ', value: 'guangdong' }]

/** ä¸»é¢˜é€‰é¡¹ */
const THEME_OPTIONS = [{ label: 'äº®è‰²', value: 'light' }, { label: 'æš—è‰²', value: 'dark' }, { label: 'è‡ªå®šä¹‰', value: 'custom' }]

// ========== è¡¨å• ==========

const st = ref<InstanceType<typeof StatusTabs>>()

const form = useCreateForm({
  initialValues: {
    title: 'å‘˜å·¥æ¡£æ¡ˆ', name: 'å¼ ä¸‰', age: 28, gender: 'male',
    phone: '13800138000', email: 'zhangsan@example.com',
    emergencyName: 'æå¥³å£«', emergencyRelation: 'spouse', emergencyPhone: '13900139000',
    province: 'beijing', city: 'åŒ—äº¬', zipCode: '100000', addressDetail: 'æœé˜³åŒºæŸæŸè¡—é“1å·',
    companyName: 'ç§‘æŠ€æœ‰é™å…¬å¸', department: 'ç ”å‘éƒ¨', position: 'é«˜çº§å·¥ç¨‹å¸ˆ',
    building: 'A æ ‹', floor: '12F', seat: 'A-12-03',
    theme: 'light', customColor: '', emailNotify: true, smsNotify: false, dnd: false,
  },
})

// ========== è”åŠ¨ï¼šä¸»é¢˜ä¸ºã€Œè‡ªå®šä¹‰ã€æ—¶æ˜¾ç¤ºé¢œè‰²è¾“å…¥ ==========

/** åˆå§‹éšè— customColor å­—æ®µ */
form.getField('customColor')?.setVisible(false)

/** ä¸»é¢˜å˜åŒ– â†’ æ§åˆ¶è‡ªå®šä¹‰é¢œè‰²å­—æ®µçš„å¯è§æ€§å’Œå¿…å¡«çŠ¶æ€ */
form.onFieldValueChange('theme', (value: unknown) => {
  const field = form.getField('customColor')
  if (!field) return
  const isCustom = value === 'custom'
  field.setVisible(isCustom)
  field.required = isCustom
})

/** åŒæ­¥ StatusTabs çš„ mode åˆ° form.pattern */
watch(() => st.value?.mode, (v) => {
  if (v)
    form.pattern = v as FieldPattern
}, { immediate: true })

</script>
